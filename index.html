<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®åœ‹/æ˜“ä¸åœ°æ”¿ - å°ˆæ¥­å ±åƒ¹å–®ç³»çµ±</title>
    <style>
        :root {
            --primary-color: #c8102e; /* å®åœ‹ç´… */
            --secondary-color: #005a87; /* æ˜“ä¸è— */
            --gray-text: #555;
            --border-color: #ddd;
        }

        body {
            font-family: "Microsoft JhengHei", "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 0; /* ç§»é™¤å¤–è·ä»¥é©æ‡‰æ»¿ç‰ˆ */
            display: flex;
            height: 100vh;
            box-sizing: border-box;
            overflow: hidden; /* é˜²æ­¢é›™é‡æ²è»¸ */
        }

        /* --- å·¦å´æ§åˆ¶é¢æ¿ (éŸ¿æ‡‰å¼èª¿æ•´) --- */
        .control-panel {
            width: 400px; /* å›ºå®šå¯¬åº¦ï¼Œé¿å…éå¯¬ */
            flex-shrink: 0;
            background: white;
            padding: 25px;
            border-right: 1px solid #ddd;
            overflow-y: auto; /* å…§å®¹éå¤šæ™‚å¯æ²å‹• */
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            z-index: 10;
        }

        .control-panel h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .section-title {
            font-size: 14px;
            color: var(--secondary-color);
            font-weight: bold;
            margin: 20px 0 10px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }

        .form-group {
            margin-bottom: 12px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            font-size: 0.9em;
            color: #333;
        }

        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }

        .btn {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            margin-top: 15px;
            font-size: 16px;
            font-weight: bold;
            transition: background 0.3s;
        }
        .btn:hover { background-color: #004466; }

        .btn-green { background-color: #28a745; margin-top: 5px;}
        .btn-green:hover { background-color: #218838; }
        
        .btn-red { background-color: #dc3545; width: auto; padding: 5px 10px; margin-top: 0; font-size: 12px;}
        
        .item-row {
            display: grid;
            grid-template-columns: 2fr 0.8fr 1fr auto; /* èª¿æ•´æ¬„ä½æ¯”ä¾‹ */
            gap: 5px;
            margin-bottom: 8px;
            align-items: center;
            background: #f9f9f9;
            padding: 5px;
            border-radius: 4px;
        }

        /* --- å³å´é è¦½å€ (A4 ç´™å¼µæ¨¡æ“¬) --- */
        .preview-container {
            flex: 1;
            background: #525659;
            padding: 40px;
            overflow-y: auto; /* è®“å³å´å¯ä»¥ç¨ç«‹æ²å‹• */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* è®“ A4 ç´™å¼µå¾ä¸Šé¢é–‹å§‹ */
        }

        .a4-page {
            background: white;
            width: 210mm;
            min-height: 297mm; /* ä¿æŒ A4 é«˜åº¦ */
            padding: 15mm 20mm;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            position: relative;
            box-sizing: border-box;
            /* è®“å…§å®¹æ’é–‹æ™‚ä¿æŒç™½åº• */
            height: auto; 
        }

        /* --- å ±åƒ¹å–®å…§æ¨£å¼ --- */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            border-bottom: 3px solid var(--secondary-color);
            padding-bottom: 15px;
        }

        .logos {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .logos img {
            height: 65px;
            object-fit: contain;
        }

        .company-info {
            text-align: right;
            font-size: 12px;
            color: var(--gray-text);
            line-height: 1.4;
        }

        .company-info h1 {
            margin: 0 0 5px 0;
            color: #333;
            font-size: 16px; 
            font-weight: 800;
        }

        .quote-title {
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            margin: 15px 0 25px 0;
            letter-spacing: 3px;
            color: #222;
        }

        .info-grid {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            gap: 20px;
        }

        .client-info, .meta-info {
            width: 48%;
        }

        .info-row {
            display: flex;
            margin-bottom: 8px;
            border-bottom: 1px solid #f0f0f0;
            padding-bottom: 2px;
        }

        .info-label {
            width: 85px;
            font-weight: bold;
            color: #444;
            font-size: 14px;
        }

        .info-value {
            flex: 1;
            color: #000;
            font-size: 14px;
        }

        /* è¡¨æ ¼æ¨£å¼ */
        table.quote-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        table.quote-table th {
            background-color: var(--secondary-color);
            color: white;
            padding: 8px 10px;
            text-align: left;
            font-size: 14px;
            border: 1px solid var(--secondary-color);
        }

        table.quote-table td {
            padding: 8px 10px;
            border: 1px solid #ddd;
            color: #333;
            font-size: 14px;
        }

        .text-right { text-align: right; }
        .text-center { text-align: center; }

        .totals-section {
            width: 50%;
            margin-left: auto;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 10px;
            font-size: 14px;
        }

        .total-row.final {
            background-color: #f8f9fa;
            font-weight: bold;
            border-top: 2px solid #333;
            border-bottom: 1px solid #333;
            font-size: 16px;
            margin-top: 10px;
            padding: 10px;
        }

        .notes-section {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #eee;
            border-left: 5px solid var(--primary-color);
            background-color: #fffbfc;
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap; /* ä¿ç•™æ›è¡Œ */
            text-align: left; /* å¼·åˆ¶é å·¦ */
            color: #333;
        }

        .signature-section {
            margin-top: 60px;
            display: flex;
            justify-content: space-between;
            page-break-inside: avoid;
        }

        .sig-box {
            width: 40%;
            border-top: 1px solid #333;
            padding-top: 10px;
            text-align: center;
            font-size: 14px;
            color: #333;
        }

        /* --- éŸ¿æ‡‰å¼åª’é«”æŸ¥è©¢ (Mobile/Tablet) --- */
        @media screen and (max-width: 900px) {
            body {
                flex-direction: column; /* æ”¹ç‚ºå‚ç›´æ’åˆ— */
                height: auto;
                overflow: auto;
            }

            .control-panel {
                width: 100%;
                max-width: none;
                height: auto;
                border-right: none;
                border-bottom: 1px solid #ddd;
                padding: 20px;
            }

            .preview-container {
                width: 100%;
                padding: 10px;
                background: #e0e0e0;
            }

            .a4-page {
                width: 100%;
                min-height: auto;
                padding: 10mm;
            }
        }

        /* --- åˆ—å°æ§åˆ¶ --- */
        @media print {
            body { background: white; padding: 0; display: block; height: auto; overflow: visible; }
            .control-panel { display: none; }
            .preview-container { background: white; padding: 0; display: block; width: 100%; }
            .a4-page { 
                width: 100%; 
                box-shadow: none; 
                padding: 0; 
                margin: 0; 
                border: none;
            }
            @page { margin: 15mm; }
        }
    </style>
</head>
<body>

    <div class="control-panel">
        <h2>ğŸ› ï¸ å ±åƒ¹å–®è¨­å®š</h2>
        
        <div class="section-title">åŸºæœ¬è³‡è¨Š</div>
        <div class="form-group">
            <label>å ±åƒ¹å–®è™Ÿ / ä¸»é¡Œ</label>
            <input type="text" id="inputSubject" value="è½å¿ƒè‹‘~å¤§æ¨“æˆ¶åˆ¥å¯¦åƒ¹ç™»éŒ„æ›´æ­£" oninput="updatePreview()">
        </div>
        <div class="form-group">
            <label>å ±åƒ¹æ—¥æœŸ</label>
            <input type="date" id="inputDate" oninput="updatePreview()">
        </div>
        <div class="form-group">
            <label>æœ‰æ•ˆæœŸé™</label>
            <input type="date" id="inputValidDate" oninput="updatePreview()">
        </div>

        <div class="section-title">æˆ‘æ–¹è³‡è¨Š (å…¬å¸)</div>
        <div class="form-group">
            <label>å…¬å¸åœ°å€</label>
            <input type="text" id="inputCompanyAddress" value="å°å—å¸‚åŒ—å€æ–‡è³¢è·¯1080å··11è™Ÿ" oninput="updatePreview()">
        </div>
        <div class="form-group">
            <label>è¯çµ¡äºº / è·ç¨±</label>
            <input type="text" id="inputContact" value="æ¥Šç¿Š åœ°æ”¿å£«" oninput="updatePreview()">
        </div>
        <div class="form-group">
            <label>è¯çµ¡é›»è©±</label>
            <input type="text" id="inputPhone" value="0912-584-498" oninput="updatePreview()">
        </div>

        <div class="section-title">å®¢æˆ¶è³‡è¨Š</div>
        <div class="form-group">
            <label>å®¢æˆ¶åç¨± (æŠ¬é ­)</label>
            <input type="text" id="inputClient" value="é•·ç¯‰èˆˆæ¥­æœ‰é™å…¬å¸" oninput="updatePreview()">
        </div>
        <div class="form-group">
            <label>å®¢æˆ¶åœ°å€</label>
            <input type="text" id="inputClientAddress" value="" placeholder="è«‹è¼¸å…¥å®¢æˆ¶åœ°å€" oninput="updatePreview()">
        </div>

        <div class="section-title">å ±åƒ¹é …ç›®</div>
        <div id="itemsContainer">
            </div>
        <button class="btn btn-green" onclick="addItem()">+ æ–°å¢é …ç›®</button>

        <div class="section-title">é‡‘é¡èˆ‡æ¢æ¬¾</div>
        <div class="form-group">
            <label>æŠ˜æ‰£é‡‘é¡ (å…ƒ)</label>
            <input type="number" id="inputDiscount" value="100000" oninput="calculateTotal()">
        </div>

        <div class="form-group">
            <label>å‚™è¨»æ¢æ¬¾</label>
            <textarea id="inputNotes" rows="6" oninput="updatePreview()">æ­¤ææ¡ˆåŒ…æ‹¬ä¸‹è¿°æ¢ä»¶:
1. è©²å ±åƒ¹ä¸å«æ”¿åºœå–®ä½æ‰€æ”¶å–ä¹‹ç¨…é‡‘ï¼Œç”±å»ºè¨­å…¬å¸è² æ“”ä¹‹è²»ç”¨ï¼Œä¸¦é…åˆå»ºè¨­å…¬å¸åˆ†æ‰¹äº¤å±‹æ™‚è«‹æ¬¾ã€‚
2. åŸå§‹å ±åƒ¹18è¬4000å…ƒï¼Œåˆä½œå» å•†å°ˆæ¡ˆå ±åƒ¹æŠ˜æ‰£å¾Œç¸½è¨ˆ10è¬å…ƒæ•´ã€‚
3. åŒ¯æ¬¾è³‡è¨Šï¼š(è«‹åœ¨æ­¤è¼¸å…¥éŠ€è¡Œå¸³è™Ÿ)</textarea>
        </div>

        <button class="btn" onclick="window.print()">ğŸ–¨ï¸ åˆ—å° / å­˜æˆ PDF</button>
    </div>

    <div class="preview-container">
        <div class="a4-page">
            
            <div class="header">
                <div class="logos">
                    <img src="å®åœ‹åœ°æ”¿å°é¢.jpg" alt="å®åœ‹åœ°æ”¿" onerror="this.style.display='none'; document.getElementById('logo-text-hg').style.display='block'">
                    <img src="æœªå‘½å2.png" alt="æ˜“ä¸åœ°æ”¿" onerror="this.style.display='none'; document.getElementById('logo-text-yc').style.display='block'">
                    
                    <div id="logo-text-hg" style="display:none; font-weight:bold; color:#c8102e; font-size:20px;">HG å®åœ‹åœ°æ”¿</div>
                    <div id="logo-text-yc" style="display:none; font-weight:bold; color:#005a87; font-size:20px; margin-left:10px;">æ˜“ä¸åœ°æ”¿å£«äº‹å‹™æ‰€</div>
                </div>
                <div class="company-info">
                    <h1>å®åœ‹åœ°æ”¿å£«äº‹å‹™æ‰€ | æ˜“ä¸åœ°æ”¿å£«äº‹å‹™æ‰€</h1>
                    <div id="displayCompanyAddress">å°å—å¸‚åŒ—å€æ–‡è³¢è·¯1080å··11è™Ÿ</div>
                    <div>TEL: 06-258-2589 | FAX: 06-250-3839</div>
                    <div>E-MAIL: homegoestate@gmail.com</div>
                </div>
            </div>

            <div class="quote-title">å ± åƒ¹ å–® (QUOTATION)</div>

            <div class="info-grid">
                <div class="client-info">
                    <div class="info-row">
                        <div class="info-label">å®¢æˆ¶åç¨±ï¼š</div>
                        <div class="info-value" id="displayClient"></div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">å®¢æˆ¶åœ°å€ï¼š</div>
                        <div class="info-value" id="displayClientAddress"></div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">å°ˆæ¡ˆåç¨±ï¼š</div>
                        <div class="info-value" id="displaySubject"></div>
                    </div>
                </div>
                <div class="meta-info">
                    <div class="info-row">
                        <div class="info-label">å ±åƒ¹æ—¥æœŸï¼š</div>
                        <div class="info-value" id="displayDate"></div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">æœ‰æ•ˆæœŸé™ï¼š</div>
                        <div class="info-value" id="displayValidDate"></div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">è¯çµ¡çª—å£ï¼š</div>
                        <div class="info-value"><span id="displayContact"></span> (<span id="displayPhone"></span>)</div>
                    </div>
                </div>
            </div>

            <table class="quote-table">
                <thead>
                    <tr>
                        <th style="width: 45%">é …ç›® / æè¿°</th>
                        <th class="text-center" style="width: 10%">æ•¸é‡</th>
                        <th class="text-right" style="width: 20%">å–®åƒ¹</th>
                        <th class="text-right" style="width: 25%">é‡‘é¡</th>
                    </tr>
                </thead>
                <tbody id="displayItems">
                    </tbody>
            </table>

            <div class="totals-section">
                <div class="total-row">
                    <span>å°è¨ˆ (Subtotal):</span>
                    <span id="displaySubtotal">NT$0</span>
                </div>
                <div class="total-row">
                    <span>ç¨…é‡‘ (Tax 0%):</span>
                    <span>NT$0</span>
                </div>
                <div class="total-row" style="color: var(--primary-color);">
                    <span>æŠ˜æ‰£ (Discount):</span>
                    <span id="displayDiscount">-NT$0</span>
                </div>
                <div class="total-row final">
                    <span>ç¸½è¨ˆ (Total):</span>
                    <span id="displayTotal">NT$0</span>
                </div>
            </div>

            <div class="notes-section">
                <strong>å‚™è¨»äº‹é …ï¼š</strong><br>
                <span id="displayNotes"></span>
            </div>

            <div class="signature-section">
                <div class="sig-box">
                    å®¢æˆ¶ç°½ç½² (Acceptance)
                    <br><br><br>
                </div>
                <div class="sig-box">
                    å…¬å¸æˆæ¬Šä»£è¡¨ (Authorized)
                    <br><br><br>
                </div>
            </div>

        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ—¥æœŸ
        document.getElementById('inputDate').valueAsDate = new Date();
        let d = new Date();
        let lastDay = new Date(d.getFullYear(), d.getMonth() + 1, 0);
        document.getElementById('inputValidDate').valueAsDate = lastDay;

        // åˆå§‹é …ç›®è³‡æ–™
        let items = [
            { desc: 'è½å¿ƒè‹‘~å¤§æ¨“æˆ¶åˆ¥å¯¦åƒ¹ç™»éŒ„æ›´æ­£', qty: 50, price: 4000 }
        ];

        function renderInputItems() {
            const container = document.getElementById('itemsContainer');
            container.innerHTML = '';
            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'item-row';
                div.innerHTML = `
                    <input type="text" placeholder="å“é …" value="${item.desc}" oninput="updateItem(${index}, 'desc', this.value)">
                    <input type="number" placeholder="æ•¸" value="${item.qty}" oninput="updateItem(${index}, 'qty', this.value)">
                    <input type="number" placeholder="å–®åƒ¹" value="${item.price}" oninput="updateItem(${index}, 'price', this.value)">
                    <button class="btn btn-red" onclick="removeItem(${index})">X</button>
                `;
                container.appendChild(div);
            });
            updatePreview();
        }

        function addItem() {
            items.push({ desc: '', qty: 1, price: 0 });
            renderInputItems();
        }

        function removeItem(index) {
            items.splice(index, 1);
            renderInputItems();
        }

        function updateItem(index, field, value) {
            if (field === 'qty' || field === 'price') {
                items[index][field] = parseFloat(value) || 0;
            } else {
                items[index][field] = value;
            }
            calculateTotal();
        }

        function formatMoney(amount) {
            return 'NT$' + amount.toFixed(0).replace(/\d(?=(\d{3})+$)/g, '$&,');
        }

        function calculateTotal() {
            let subtotal = 0;
            const tbody = document.getElementById('displayItems');
            tbody.innerHTML = '';

            items.forEach(item => {
                const amount = item.qty * item.price;
                subtotal += amount;
                tbody.innerHTML += `
                    <tr>
                        <td>${item.desc}</td>
                        <td class="text-center">${item.qty}</td>
                        <td class="text-right">${formatMoney(item.price)}</td>
                        <td class="text-right">${formatMoney(amount)}</td>
                    </tr>
                `;
            });

            const discount = parseFloat(document.getElementById('inputDiscount').value) || 0;
            const total = subtotal - discount;

            document.getElementById('displaySubtotal').innerText = formatMoney(subtotal);
            document.getElementById('displayDiscount').innerText = '-' + formatMoney(discount);
            document.getElementById('displayTotal').innerText = formatMoney(total);
        }

        function updatePreview() {
            document.getElementById('displaySubject').innerText = document.getElementById('inputSubject').value;
            document.getElementById('displayClient').innerText = document.getElementById('inputClient').value;
            document.getElementById('displayClientAddress').innerText = document.getElementById('inputClientAddress').value;
            document.getElementById('displayDate').innerText = document.getElementById('inputDate').value;
            document.getElementById('displayValidDate').innerText = document.getElementById('inputValidDate').value;
            document.getElementById('displayNotes').innerText = document.getElementById('inputNotes').value;
            document.getElementById('displayContact').innerText = document.getElementById('inputContact').value;
            document.getElementById('displayPhone').innerText = document.getElementById('inputPhone').value;
            document.getElementById('displayCompanyAddress').innerText = document.getElementById('inputCompanyAddress').value;
            
            calculateTotal();
        }

        // å•Ÿå‹•
        renderInputItems();
    </script>
</body>
</html>